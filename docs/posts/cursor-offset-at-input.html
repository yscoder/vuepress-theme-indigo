<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ Â· Yusen&#39;s Blog Â· å­¦ä¹ å¼¯é“è¶…è½¦çš„æŠ€å·§ï¼</title>
    <meta name="description" content="JavaScript å¦‚ä½•è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®ï¼Œåœ¨å…‰æ ‡å¤„æ’å…¥æˆ–æ›¿æ¢å†…å®¹">
    <link rel="shortcut icon" href="/vuepress-theme-indigo/favicon.ico">
  <link rel="manifest" href="/vuepress-theme-indigo/manifest.json">
  <meta name="theme-color" content="#3F51B5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/vuepress-theme-indigo/icons/192.png">
  <meta name="msapplication-TileImage" content="/icons/192.png">
  <meta name="msapplication-TileColor" content="#3F51B5">
    
    <link rel="preload" href="/vuepress-theme-indigo/assets/css/8.styles.7a1efded.css" as="style"><link rel="preload" href="/vuepress-theme-indigo/assets/js/app.fb417789.js" as="script"><link rel="preload" href="/vuepress-theme-indigo/assets/js/6.4fa749e3.js" as="script"><link rel="prefetch" href="/vuepress-theme-indigo/assets/js/0.1dea69ed.js"><link rel="prefetch" href="/vuepress-theme-indigo/assets/js/1.9f3090f9.js"><link rel="prefetch" href="/vuepress-theme-indigo/assets/js/2.0f95574c.js"><link rel="prefetch" href="/vuepress-theme-indigo/assets/js/3.e32cdc76.js"><link rel="prefetch" href="/vuepress-theme-indigo/assets/js/4.ffd2664e.js"><link rel="prefetch" href="/vuepress-theme-indigo/assets/js/5.162622aa.js"><link rel="prefetch" href="/vuepress-theme-indigo/assets/js/7.064aacd4.js">
    <link rel="stylesheet" href="/vuepress-theme-indigo/assets/css/8.styles.7a1efded.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-app="true" id="app" class="application theme--light"><div class="application--wrap"><aside class="navigation-drawer navigation-drawer--close navigation-drawer--fixed navigation-drawer--is-mobile" style="height:100%;margin-top:0px;max-height:calc(100% - 0px);transform:translateX(-240px);width:240px;"><div><div class="aside-brand-wrap"><div class="aside-brand"><a href="/vuepress-theme-indigo/" class="aside-avatar elevation-2 router-link-active"><img src="/vuepress-theme-indigo/face.jpg" alt="avatar"></a><hgroup class="mt-3 variant-hide"><div class="subheading white--text">ç‹æ˜±æ£®</div><a href="mailto:iyusen@foxmail.com" title="iyusen@foxmail.com" class="aside-mail primary--text text--lighten-5">iyusen@foxmail.com</a></hgroup></div></div><hr class="divider theme--dark"><div class="list nav-list"><div class="secondary--text"><a href="/vuepress-theme-indigo/" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fa fa-home"></i></div></div><div class="list__tile__content">Home</div></a></div><div class="secondary--text"><a href="/vuepress-theme-indigo/tags" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fa fa-tag"></i></div></div><div class="list__tile__content">Tags</div></a></div><div class="secondary--text"><a href="https://github.com/yscoder" target="_blank" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fab fa-github"></i></div></div><div class="list__tile__content">Github</div></a></div><div class="secondary--text"><a href="https://www.weibo.com/ysweb" target="_blank" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fab fa-weibo"></i></div></div><div class="list__tile__content">Weibo</div></a></div></div></div><div class="navigation-drawer__border"></div></aside><nav class="blog-toolbar toolbar toolbar--fixed theme--dark primary" style="margin-top:0px;padding-right:0px;padding-left:0px;transform:translateY(0px);"><div class="toolbar__content" style="height:56px;"><button type="button" class="btn btn--icon"><div class="btn__content"><i class="fa fa-bars"></i></div></button><div class="toolbar__title">JavaScript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜</div><div class="spacer"></div><button type="button" class="btn btn--icon"><div class="btn__content"><i class="fa fa-search"></i></div></button><!----></div></nav><main class="content" style="padding-top:56px;padding-right:0px;padding-bottom:0px;padding-left:0px;"><div class="content--wrap"><div class="container blog-container grid-list-xl align-center"><div class="layout row wrap"><div class="flex mb-3 xs12"><article class="card elevation-16 post-card" style="height:auto;"><div class="card__title"><div class="flex xs12"><h2 class="display-1 mb-2">JavaScript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜</h2><div class="post-meta"><time datetime="2016-11-25T10:02:01.000Z" class="secondary--text">2016å¹´11æœˆ25æ—¥</time></div></div></div><div class="card__text pt-0 pb-0"><div class="flex xs12"><div class="content custom"><h2 id="å‰è¨€"><a href="#å‰è¨€" aria-hidden="true" class="header-anchor">#</a> å‰è¨€</h2><p>åœ¨è¾“å…¥ç¼–è¾‘çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯èƒ½ä¼šéœ€è¦åœ¨å…‰æ ‡å½“å‰çš„ä½ç½®æˆ–é™„è¿‘æ˜¾ç¤ºæç¤ºé€‰é¡¹ã€‚æ¯”å¦‚ç¤¾äº¤è¯„è®ºä¸­çš„<code>@user</code>åŠŸèƒ½ï¼Œè¦ç¡®ä¿æç¤ºçš„ç”¨æˆ·åˆ—è¡¨æ€»æ˜¯å‡ºç°åœ¨<code>@</code>å­—ç¬¦å³ä¸‹æ–¹ï¼Œåˆæˆ–è€…æ˜¯åœ¨è‡ªå®šä¹‰ç¼–è¾‘å™¨ä¸­ autocomplete è¯­æ³•æç¤ºï¼Œéƒ½éœ€è¦è·å–å…‰æ ‡å½“å‰çš„ä½ç½®ä½œä¸ºå‚ç…§ç‚¹ã€‚</p><h2 id="ä¸¤ç§ä½ç½®"><a href="#ä¸¤ç§ä½ç½®" aria-hidden="true" class="header-anchor">#</a> ä¸¤ç§ä½ç½®</h2><p>å¯¹äº WEB å¼€å‘æ¥è®²ï¼Œå½“æˆ‘ä»¬æåˆ°æŸæŸå…ƒç´ çš„ä½ç½®ï¼Œé€šå¸¸æ˜¯æŒ‡è¿™ä¸ªå…ƒç´ ç›¸å¯¹äºçˆ¶çº§æˆ–æ–‡æ¡£çš„åƒç´ å•ä½åæ ‡ã€‚è€Œå¯¹äºè¾“å…¥æ¡†ä¸­å…‰æ ‡ï¼Œå°±æœ‰äº†é¢å¤–çš„åŒºåˆ†ã€‚</p><h3 id="ç›¸å¯¹äºå†…å®¹"><a href="#ç›¸å¯¹äºå†…å®¹" aria-hidden="true" class="header-anchor">#</a> ç›¸å¯¹äºå†…å®¹</h3><p>ç›¸å¯¹äºå†…å®¹ï¼Œå…‰æ ‡ä½äºç¬¬å‡ ä¸ªå­—ç¬¦ä¹‹åï¼Œå§‘ä¸”ç§°ä¹‹ä¸º<strong>å­—ç¬¦ä½ç½®</strong>å§ã€‚</p><h3 id="ç›¸å¯¹äº-ui"><a href="#ç›¸å¯¹äº-ui" aria-hidden="true" class="header-anchor">#</a> ç›¸å¯¹äº UI</h3><p>ç›¸å¯¹äº UIï¼Œä¹Ÿå°±æ˜¯è·Ÿæ™®é€šé¡µé¢å…ƒç´ ä¸€æ ·çš„<strong>åƒç´ ä½ç½®</strong>äº†ã€‚</p><h2 id="æ’å…¥æˆ–æ›¿æ¢å†…å®¹"><a href="#æ’å…¥æˆ–æ›¿æ¢å†…å®¹" aria-hidden="true" class="header-anchor">#</a> æ’å…¥æˆ–æ›¿æ¢å†…å®¹</h2><p>åœ¨å‰è¨€æåˆ°çš„åœºæ™¯ä¸­ï¼Œä¹Ÿæœ‰åœ¨å…‰æ ‡ä½ç½®å¤„æ’å…¥å†…å®¹çš„éœ€æ±‚ï¼Œæ¯”å¦‚å¯¹é€‰å–æ–‡å­—åŠ ç²—<code>text =&gt; &lt;strong&gt;text&lt;/strong&gt;</code>ç­‰ã€‚</p><h3 id="textarea"><a href="#textarea" aria-hidden="true" class="header-anchor">#</a> textarea</h3><p><code>textarea</code>å…ƒç´ å¯ä»¥å¾ˆå®¹æ˜“è·å–åˆ°é€‰æ‹©çš„ä¸€æ®µæ–‡å­—çš„èµ·æ­¢ä½ç½®ã€‚å¦‚æœå½“å‰æ²¡æœ‰é€‰æ‹©æ–‡å­—ï¼Œåˆ™ä¸¤ä¸ªä½ç½®å€¼éƒ½ä¸ºå…‰æ ‡å³ä¾§å­—ç¬¦çš„ç´¢å¼•ï¼Œä» 0 å¼€å§‹ã€‚</p><pre class="language-js"><code><span class="token comment">// å¼€å§‹ä½ç½®</span>
textarea<span class="token punctuation">.</span>selectionStart
<span class="token comment">// ç»“æŸä½ç½®</span>
textarea<span class="token punctuation">.</span>selectionEnd
</code></pre><p>å¯¹äºåŠ ç²—åŠŸèƒ½ï¼Œæœ‰äº†èµ·æ­¢ä½ç½®ï¼Œå°±èƒ½è·å–åˆ°é€‰æ‹©çš„æ–‡å­—å†…å®¹ï¼Œç„¶åå¯¹å†…å®¹è¿›è¡Œæ›¿æ¢ã€‚ç”±äº<code>textarea</code>ä¸èƒ½åŒ…å«å­å…ƒç´ ï¼Œåªæœ‰çº¯æ–‡æœ¬ï¼Œæ‰€ä»¥åŸºäº<code>textarea</code>å®ç°åŠ ç²—åªèƒ½åƒç”¨ Markdown æ ‡è®°è¯­æ³•å®ç°ã€‚</p><pre class="language-js"><code><span class="token keyword">var</span> selectedText <span class="token operator">=</span> textarea<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>textarea<span class="token punctuation">.</span>selectionStart<span class="token punctuation">,</span> textarea<span class="token punctuation">.</span>selectionEnd<span class="token punctuation">)</span>
textarea<span class="token punctuation">.</span><span class="token function">setRangeText</span><span class="token punctuation">(</span><span class="token string">'**'</span> <span class="token operator">+</span> selectedText <span class="token operator">+</span> <span class="token string">'**'</span><span class="token punctuation">)</span>
</code></pre><blockquote><p><code>textarea.setRangeText(text: String)</code> æŠŠé€‰ä¸­çš„æ–‡å­—æ›¿æ¢ä¸ºå…¶ä»–å†…å®¹ã€‚</p></blockquote><h3 id="contenteditable"><a href="#contenteditable" aria-hidden="true" class="header-anchor">#</a> contenteditable</h3><p>ä¹Ÿå¯èƒ½æˆ‘ä»¬ä¼šä½¿ç”¨<code>contenteditable</code>å±æ€§æŠŠä¸€ä¸ªå…ƒç´ å˜ä¸ºå¯ç¼–è¾‘å…ƒç´ ã€‚è€Œä¸Šé¢æ‰€ç”¨çš„å±æ€§å’Œå‡½æ•°éƒ½æ˜¯æ™®é€šå…ƒç´ æ‰€æ²¡æœ‰çš„ï¼Œæ‰€ä»¥è¦æ¢ä¸€ç§å§¿åŠ¿å®ç°ã€‚</p><p>è¿˜æ˜¯ä»¥åŠ ç²—åŠŸèƒ½ä¸ºä¾‹ã€‚</p><pre class="language-js"><code><span class="token comment">// è·å–æ–‡æ¡£ä¸­é€‰ä¸­åŒºåŸŸ</span>
<span class="token keyword">var</span> range <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> strongNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'strong'</span><span class="token punctuation">)</span>
<span class="token comment">// é€‰ä¸­åŒºåŸŸæ–‡æœ¬</span>
strongNode<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// åˆ é™¤é€‰ä¸­åŒº</span>
range<span class="token punctuation">.</span><span class="token function">deleteContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// åœ¨å…‰æ ‡å¤„æ’å…¥æ–°èŠ‚ç‚¹</span>
range<span class="token punctuation">.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>strongNode<span class="token punctuation">)</span>
</code></pre><p>åŸºäº<code>contenteditable</code>çš„å¯ç¼–è¾‘å…ƒç´ ï¼Œå…¶ä¸­çš„å†…å®¹å‡ä¸ºå­å…ƒç´ ï¼Œæ–‡æœ¬ä¸º<code>textNode</code>ï¼ŒåŠ ç²—ä½¿ç”¨ HTML å…ƒç´ ï¼Œæ’å…¥æˆ–æ›¿æ¢æ˜¯å¯¹å…ƒç´ çš„æ“ä½œã€‚</p><p>å¦‚æœæƒ³ä½¿ç”¨æ“ä½œå†…å®¹çš„æ€è·¯å®ç°ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºå¯ä»¥è·å–åˆ°çš„èµ·æ­¢ä½ç½®æ˜¯åŸºäºå­å…ƒç´ çš„ã€‚</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">contenteditable</span><span class="token punctuation">&gt;</span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ä½ å¥½<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>big</span><span class="token punctuation">&gt;</span></span>w<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>big</span><span class="token punctuation">&gt;</span></span>orld<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>å‡å¦‚é€‰ä¸­çš„æ–‡å­—æ˜¯<code>ä½ å¥½wor</code>ï¼Œè°ƒç”¨ç›¸å…³ API çš„è¾“å‡ºå¦‚ä¸‹ã€‚</p><pre class="language-js"><code><span class="token comment">// å½“å‰åœ¨æ–‡æ¡£ä¸­é€‰æ‹©çš„æ–‡æœ¬ï¼Œdocument å’Œ window éƒ½æœ‰è¿™ä¸ªå‡½æ•°</span>
<span class="token comment">// var selection = document.getSelection()</span>
<span class="token keyword">var</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
selection<span class="token punctuation">.</span>anchorNode <span class="token comment">// ä½ å¥½</span>
selection<span class="token punctuation">.</span>anchorOffset <span class="token comment">// 0</span>
selection<span class="token punctuation">.</span>focusNode <span class="token comment">// orld</span>
selection<span class="token punctuation">.</span>focusOffset <span class="token comment">// 2</span>

<span class="token comment">// æˆ–è€…ä½¿ç”¨ Range</span>
<span class="token keyword">var</span> range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
range<span class="token punctuation">.</span>startContainer <span class="token comment">// ä½ å¥½</span>
range<span class="token punctuation">.</span>startOffset <span class="token comment">// 0</span>
range<span class="token punctuation">.</span>endContainer <span class="token comment">// orld</span>
range<span class="token punctuation">.</span>endOffset <span class="token comment">// 2</span>
</code></pre><p>æœ€ç»ˆå¯ä»¥è·å–åˆ°èµ·æ­¢å…ƒç´ ä»¥åŠé€‰ä¸­åŒºåŸŸåœ¨å¼€å§‹å…ƒç´ å†…å®¹ä¸­çš„å­—ç¬¦ä½ç½®å’Œåœ¨ç»“æŸå…ƒç´ å†…å®¹ä¸­çš„å­—ç¬¦ä½ç½®ã€‚å…¶ä¸­çš„èµ·æ­¢å…ƒç´ å‡ä¸º<code>textNode</code>ç±»å‹ï¼Œé€šè¿‡<code>parentNode</code>è·å–åˆ°åŒ…è£¹å…ƒç´ ã€‚</p><pre class="language-js"><code>range<span class="token punctuation">.</span>startContainer<span class="token punctuation">.</span>parentNode <span class="token comment">// &lt;strong&gt;ä½ å¥½&lt;/strong&gt;</span>
range<span class="token punctuation">.</span>endContainer<span class="token punctuation">.</span>parentNode <span class="token comment">// &lt;div contenteditable&gt;...&lt;/div&gt;</span>
</code></pre><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯é€šè¿‡<code>Selection</code>å’Œ<code>Rang</code>è·å–åˆ°èµ·æ­¢ä½ç½®æ˜¯æœ‰æ–¹å‘ä¹‹åˆ†çš„ï¼Œä»å·¦å‘å³é€‰æ‹©å’Œä»å³å‘å·¦é€‰æ‹©å¾—åˆ°çš„å€¼æ˜¯æ­£å¥½ç›¸åçš„ã€‚</p></blockquote><h2 id="åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹"><a href="#åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹" aria-hidden="true" class="header-anchor">#</a> åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹</h2><p>è¿™é‡Œå°±è¦å¼€å§‹ç”¨åƒç´ ä½ç½®ï¼ŒåŒæ ·åˆ†ä¸ºä¸¤ç§å®ç°æ¥è®²ã€‚</p><h3 id="contenteditable-2"><a href="#contenteditable-2" aria-hidden="true" class="header-anchor">#</a> contenteditable</h3><p>å¯ç¼–è¾‘å…ƒç´ è·å–å…‰æ ‡åƒç´ ä½ç½®å°±åƒ<code>textarea</code>è·å–å…‰æ ‡çš„å­—ç¬¦ä½ç½®ä¸€æ ·ç®€å•ã€‚</p><pre class="language-js"><code><span class="token keyword">var</span> range <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
range<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { width, height, top, right, bottom, right }</span>
</code></pre><p>è¿™ä¹ˆå…·ä½“çš„å°ºå¯¸å€¼ï¼Œå®ç°è‡ªåŠ¨å®ŒæˆçœŸæ˜¯ So easy!</p><h3 id="textarea-2"><a href="#textarea-2" aria-hidden="true" class="header-anchor">#</a> textarea</h3><p><code>textarea</code>å…¶ä¸­çš„å†…å®¹éƒ½æ˜¯çº¯æ–‡æœ¬ï¼Œåœ¨ DOM ä¸­ä¸å­˜åœ¨ç›¸å…³çš„å¯¹è±¡ï¼Œå¯¹äºåƒç´ ä½ç½®å°±å¾—å¦ä½œä»–æƒ³äº†ã€‚</p><h4 id="åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—"><a href="#åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—" aria-hidden="true" class="header-anchor">#</a> åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—</h4><pre class="language-js"><code><span class="token comment">// 1.è·å–å…‰æ ‡ç»“æŸä½ç½®</span>
<span class="token keyword">var</span> end <span class="token operator">=</span> textarea<span class="token punctuation">.</span>selectionEnd
<span class="token comment">// 2.é€šè¿‡åŒ¹é…å…‰æ ‡ä¹‹å‰æ–‡æœ¬ä¸­çš„æ¢è¡Œç¬¦è®¡ç®—æ‰€åœ¨è¡Œ</span>
<span class="token keyword">var</span> row <span class="token operator">=</span> textarea<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\r\n|\r|\n/</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
<span class="token comment">// 3.è®¡ç®— topï¼Œè¡Œé«˜ * è¡Œæ•° + ä¸Šå¡«å…… + è¾¹æ¡†å®½åº¦</span>
<span class="token keyword">var</span> top <span class="token operator">=</span> lineHeight <span class="token operator">*</span> <span class="token punctuation">(</span>row <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> paddingTop <span class="token operator">+</span> borderWidth
<span class="token comment">// 4.è·å–å…‰æ ‡å·¦ä¾§çš„æ–‡æœ¬</span>
<span class="token keyword">var</span> leftText <span class="token operator">=</span> textarea<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\r\n|\r|\n/</span><span class="token punctuation">)</span><span class="token punctuation">[</span>row<span class="token punctuation">]</span>
<span class="token comment">// 5.å½±å“ä¸€æ®µæ–‡å­—æ‰€å å®½åº¦çš„å› ç´ å¤ªå¤šï¼Œé™¤å­—ä½“å¤§å°ã€ä¸­è‹±æ–‡ã€ç¬¦å·ã€å­—ç¬¦é—´è·ç­‰ï¼Œè¿˜æœ‰å­—ä½“ã€æµè§ˆå™¨ã€ç³»ç»Ÿç­‰å®¢è§‚å› ç´ </span>
<span class="token comment">// var left = ...</span>
</code></pre><p>è¿™ä¸ªæ–¹æ¡ˆçš„æ€è·¯æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯è€ƒè™‘æ‰€æœ‰é—®é¢˜çš„æˆæœ¬å¤ªé«˜ã€‚è™½ç„¶å¯ä»¥åˆ›å»ºæµ‹è¯•å…ƒç´ å»è®¡ç®—æ–‡æœ¬å®½åº¦ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆæœ¬èº«æ˜¯ä»ä¸¥è°¨çš„è§’åº¦å‡ºå‘çš„ã€‚ä¸å…¶æ··åœ¨ä¸€å—ï¼Œç›´æ¥ç”¨å–å·§çš„åŠæ³•æ›´ç®€å•ã€‚</p><blockquote><p><s>è¿™ä¸ªæ–¹æ¡ˆçš„æ½œå°è¯æ˜¯ï¼šæ˜æ˜å¯ä»¥é è„¸åƒé¥­ï¼Œå´ååè¦é æ‰åï¼</s> ğŸ™„</p></blockquote><h4 id="é•œåƒå…ƒç´ "><a href="#é•œåƒå…ƒç´ " aria-hidden="true" class="header-anchor">#</a> é•œåƒå…ƒç´ </h4><p>æ–‡æœ¬ä¸æ”¯æŒå®šä½ï¼Ÿé‚£æˆ‘åˆ›å»º DOM å¥½äº†ã€‚</p><pre class="language-js"><code><span class="token comment">// å…‰æ ‡ä½ç½®</span>
<span class="token keyword">var</span> end <span class="token operator">=</span> textarea<span class="token punctuation">.</span>selectionEnd
<span class="token comment">// å…‰æ ‡å‰çš„å†…å®¹</span>
<span class="token keyword">var</span> beforeText <span class="token operator">=</span> textarea<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span>
<span class="token comment">// å…‰æ ‡åçš„å†…å®¹</span>
<span class="token keyword">var</span> afterText <span class="token operator">=</span> textarea<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span>
<span class="token comment">// å¯¹å½±å“ UI çš„ç‰¹æ®Šå…ƒç´ ç¼–ç </span>
<span class="token keyword">var</span> <span class="token function-variable function">escape</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;|&gt;|`|&quot;|&amp;/g</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\r\n|\r|\n/g</span><span class="token punctuation">,</span> <span class="token string">'&lt;br&gt;'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// åˆ›å»ºé•œåƒå†…å®¹ï¼Œå¤åˆ¶æ ·å¼</span>
<span class="token keyword">var</span> mirror <span class="token operator">=</span> <span class="token string">'&lt;div class=&quot;'</span> <span class="token operator">+</span> textarea<span class="token punctuation">.</span>className <span class="token operator">+</span> <span class="token string">'&quot;&gt;'</span> <span class="token operator">+</span> <span class="token function">escape</span><span class="token punctuation">(</span>beforeText<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;span id=&quot;cursor&quot;&gt;|&lt;/span&gt;'</span> <span class="token operator">+</span> <span class="token function">escape</span><span class="token punctuation">(</span>afterText<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;/div&gt;'</span>
<span class="token comment">// æ·»åŠ åˆ° textarea åŒçº§ï¼Œæ³¨æ„è®¾ç½®å®šä½åŠ zIndexï¼Œä½¿ä¸¤ä¸ªå…ƒç´ é‡åˆ</span>
textarea<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'afterend'</span><span class="token punctuation">,</span> mirror<span class="token punctuation">)</span>
<span class="token comment">// é€šè¿‡é•œåƒå…ƒç´ ä¸­çš„å‡å…‰æ ‡å ä½å…ƒç´ è·å–åƒç´ ä½ç½®</span>
<span class="token keyword">var</span> cursor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'cursor'</span><span class="token punctuation">)</span>
cursor<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { width, height, top, right, bottom, right }</span>
</code></pre><h2 id="end"><a href="#end" aria-hidden="true" class="header-anchor">#</a> End</h2><p>æœ€åæ‚„æ‚„è¯´ä¸€å¥ï¼Œä»¥ä¸Šå†…å®¹ä¸å…¼å®¹ä½ç‰ˆæœ¬ IEï¼Œä½†æ˜¯ IE æ¯•ç«Ÿä¸»åœºè¿è¡Œï¼Œæœ‰äº› API åè€Œæ˜¯å…¶ä»–æµè§ˆå™¨æ‰€æ²¡æœ‰çš„ã€‚å°±ä¸Šé¢æåˆ°çš„æ¡ˆä¾‹æ¥è¯´ï¼Œä½ç‰ˆæœ¬ IE ä¹Ÿæœ‰å¯¹åº”çš„ API å¯ç”¨ã€‚çœŸæ˜¯ä¸æƒ³åœ¨ IE ä¸Šå»æµªè´¹ç²¾åŠ›äº†ï¼Œç´¢æ€§ä¸æã€‚</p></div></div></div><div class="card__actions"><div class="flex xs12"><span tabindex="0" class="chip chip--label chip--small"><span class="chip__content">JavaScript</span></span><span tabindex="0" class="chip chip--label chip--small"><span class="chip__content">Range</span></span><span tabindex="0" class="chip chip--label chip--small"><span class="chip__content">Selection</span></span></div></div></article></div><div class="flex text-xs-left xs6"><a href="/vuepress-theme-indigo/posts/webpack-use-lodash.html" class="post-nav btn btn--flat btn--router primary--text"><div class="btn__content"><div class="grey--text"><i class="fa mr-1 fa-chevron-left"></i>Prev</div><div class="subheading hidden-xs-only">WebpackæŒ‰éœ€æ‰“åŒ…Lodashçš„å‡ ç§æ–¹å¼</div></div></a></div><div class="flex text-xs-right xs6"><a href="/vuepress-theme-indigo/posts/text-truncation.html" class="post-nav btn btn--flat btn--router primary--text"><div class="btn__content"><div class="grey--text">Next
          <i class="fa ml-1 fa-chevron-right"></i></div><div class="subheading hidden-xs-only">å‰ç«¯æ–‡å­—çš„æˆªæ–­å¤„ç†</div></div></a></div><div class="flex mt-3 xs12"><div class="card" style="height:auto;"><div class="card__title"><span class="headline">Comment</span></div></div></div></div></div><footer class="footer blog-footer darken-1 mt-4 primary" style="height:auto;"><div class="primary--text text--lighten-4 text-xs-center card card--flat card--tile primary" style="height:auto;"><div class="card__text pb-0">åšå®¢å†…å®¹éµå¾ª <a rel="license noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a></div><div class="card__text pt-0 mt-1"><span>ç‹æ˜±æ£® Â© 2015 - 2018</span><span><!---->
        Power by
        <a href="https://vuepress.vuejs.org" target="_blank" rel="noopener noreferrer">VuePress</a> Theme
        <a href="https://github.com/yscoder/vuepress-theme-indigo" target="_blank" rel="noopener noreferrer">indigo</a></span></div></div></footer></div></main><button type="button" class="btn btn--bottom btn--floating btn--fixed btn--right accent" style="display:none;"><div class="btn__content"><i class="fa fa-lg fa-chevron-up"></i></div></button></div></div></div>
    <script src="/vuepress-theme-indigo/assets/js/6.4fa749e3.js" defer></script><script src="/vuepress-theme-indigo/assets/js/app.fb417789.js" defer></script>
  </body>
</html>
